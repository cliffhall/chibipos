{"version":3,"file":"_server-CcataWqr.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/updateMenu/_server.js"],"sourcesContent":["import CryptoJS from \"crypto-js\";\nimport { C as CRYPTO_KEY } from \"../../../../chunks/private.js\";\nimport { j as json } from \"../../../../chunks/index.js\";\nimport { P as Product } from \"../../../../chunks/product.js\";\nimport { C as CatProduct } from \"../../../../chunks/catProduct.js\";\nfunction decryptMenu(encryptedData) {\n  const bytes = CryptoJS.AES.decrypt(encryptedData, CRYPTO_KEY);\n  const decrypted = bytes.toString(CryptoJS.enc.Utf8);\n  return JSON.parse(decrypted);\n}\nasync function POST({ request }) {\n  let updateApproved = false;\n  const { encryptedMenu } = await request.json();\n  try {\n    const decodedMenu = atob(encryptedMenu);\n    const decryptedMenu = decryptMenu(decodedMenu);\n    const { cats, products } = decryptedMenu;\n    if (cats && cats.length > 0 && (products && products.length > 0)) updateApproved = true;\n    if (updateApproved) {\n      await CatProduct.bulkCreate(\n        cats.map((cat) => ({\n          id: cat.id,\n          name: cat.nombre\n        })),\n        {\n          updateOnDuplicate: [\"name\"]\n        }\n      );\n      await Product.bulkCreate(\n        products.map((product) => ({\n          id: product.id,\n          name: product.nombre,\n          image: product.image,\n          price: product.precio,\n          catproduct_id: product.catproducto_id\n        })),\n        {\n          updateOnDuplicate: [\"name\", \"image\", \"price\", \"catproduct_id\"]\n        }\n      );\n    }\n    return json({ status: 200 });\n  } catch (error) {\n    console.error(\"Error during decryption:\", error);\n    return json({ error: \"Invalid encrypted data\" }, { status: 500 });\n  }\n}\nasync function DELETE() {\n  try {\n    await Product.destroy({\n      where: {},\n      truncate: true\n    });\n    await CatProduct.destroy({\n      where: {},\n      truncate: true\n    });\n    return json(\"Cats destroyed\");\n  } catch (error) {\n    console.error(\"Error deleting: \", error);\n    return json({ error: \"Error deleting menu.\" }, { status: 500 });\n  }\n}\nexport {\n  DELETE,\n  POST\n};\n"],"names":[],"mappings":";;;;;;;;AAKA,SAAS,WAAW,CAAC,aAAa,EAAE;AACpC,EAAE,MAAM,KAAK,GAAG,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC,aAAa,EAAE,UAAU,CAAC;AAC/D,EAAE,MAAM,SAAS,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC;AACrD,EAAE,OAAO,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC;AAC9B;AACA,eAAe,IAAI,CAAC,EAAE,OAAO,EAAE,EAAE;AACjC,EAAE,IAAI,cAAc,GAAG,KAAK;AAC5B,EAAE,MAAM,EAAE,aAAa,EAAE,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE;AAChD,EAAE,IAAI;AACN,IAAI,MAAM,WAAW,GAAG,IAAI,CAAC,aAAa,CAAC;AAC3C,IAAI,MAAM,aAAa,GAAG,WAAW,CAAC,WAAW,CAAC;AAClD,IAAI,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,aAAa;AAC5C,IAAI,IAAI,IAAI,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,KAAK,QAAQ,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,EAAE,cAAc,GAAG,IAAI;AAC3F,IAAI,IAAI,cAAc,EAAE;AACxB,MAAM,MAAM,UAAU,CAAC,UAAU;AACjC,QAAQ,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,MAAM;AAC3B,UAAU,EAAE,EAAE,GAAG,CAAC,EAAE;AACpB,UAAU,IAAI,EAAE,GAAG,CAAC;AACpB,SAAS,CAAC,CAAC;AACX,QAAQ;AACR,UAAU,iBAAiB,EAAE,CAAC,MAAM;AACpC;AACA,OAAO;AACP,MAAM,MAAM,OAAO,CAAC,UAAU;AAC9B,QAAQ,QAAQ,CAAC,GAAG,CAAC,CAAC,OAAO,MAAM;AACnC,UAAU,EAAE,EAAE,OAAO,CAAC,EAAE;AACxB,UAAU,IAAI,EAAE,OAAO,CAAC,MAAM;AAC9B,UAAU,KAAK,EAAE,OAAO,CAAC,KAAK;AAC9B,UAAU,KAAK,EAAE,OAAO,CAAC,MAAM;AAC/B,UAAU,aAAa,EAAE,OAAO,CAAC;AACjC,SAAS,CAAC,CAAC;AACX,QAAQ;AACR,UAAU,iBAAiB,EAAE,CAAC,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,eAAe;AACvE;AACA,OAAO;AACP;AACA,IAAI,OAAO,IAAI,CAAC,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAChC,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,0BAA0B,EAAE,KAAK,CAAC;AACpD,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,wBAAwB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACrE;AACA;AACA,eAAe,MAAM,GAAG;AACxB,EAAE,IAAI;AACN,IAAI,MAAM,OAAO,CAAC,OAAO,CAAC;AAC1B,MAAM,KAAK,EAAE,EAAE;AACf,MAAM,QAAQ,EAAE;AAChB,KAAK,CAAC;AACN,IAAI,MAAM,UAAU,CAAC,OAAO,CAAC;AAC7B,MAAM,KAAK,EAAE,EAAE;AACf,MAAM,QAAQ,EAAE;AAChB,KAAK,CAAC;AACN,IAAI,OAAO,IAAI,CAAC,gBAAgB,CAAC;AACjC,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,kBAAkB,EAAE,KAAK,CAAC;AAC5C,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,sBAAsB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACnE;AACA;;;;"}