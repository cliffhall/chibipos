import{d as p2,t as L,a as Z,s as w}from"../chunks/cdZpXTRU.js";import{X as u2,a2 as S,a0 as a,$ as l,Z as A,_ as f2,j as e,a3 as o,a4 as o2,a1 as t,T as K,Y as C2,ar as g2}from"../chunks/CpheGI1x.js";import{a as h2,p as H,i as i2}from"../chunks/lS090TL_.js";import{k as y2}from"../chunks/CLlfmT2c.js";import{e as Q,i as W}from"../chunks/B8U8OScr.js";import{s as r2,a as v2,A as d2,t as w2,f as H2,p as D2}from"../chunks/DmQUckAG.js";import{o as b2}from"../chunks/iHDSuM_z.js";var M2=(q,u)=>u(-1),x2=(q,u)=>u(1),V2=L('<div class="day svelte-10fq9ck"><p class="svelte-10fq9ck"> </p></div>'),Z2=(q,u,y)=>u(e(y)),L2=L('<button><p class="svelte-10fq9ck"> </p></button>'),q2=L('<div class="calendar svelte-10fq9ck"><div class="header svelte-10fq9ck"><div class="month svelte-10fq9ck"><button class="svelte-10fq9ck">-</button> <div class="text svelte-10fq9ck"><p class="title svelte-10fq9ck"> </p> <p class="year svelte-10fq9ck"> </p></div> <button class="svelte-10fq9ck">+</button></div> <div class="labels svelte-10fq9ck"></div></div> <div class="body svelte-10fq9ck"></div></div>');function T2(q,u){u2(u,!0);let y=h2(u,"tickets",15);const c=["Lu","Ma","Mi","Ju","Vi","Sa","Do"];let D=S(H(new Date));const k=new Date,m=k.getMonth(),f=k.getFullYear();let C=S(H(k.getMonth())),p=S(H(k.getFullYear())),O=K(()=>new Date(e(p),e(C)).toLocaleString("es",{month:"long"})),_=S(H([]));function x(s,i){o(_,H([]));const r=new Date(s,i,1);let v=new Date(s,i+1,0);r.getDay();const g=r.getDay()===0?6:r.getDay()-1;let V=!1;s===f&&i===m&&(v=new Date,V=!0);const P=v.getDate(),B=new Date(s,i,0).getDate();for(let h=g-1;h>=0;h--)e(_).push({day:B-h,current:!1,month:i-1});for(let h=1;h<=P;h++)e(_).push({day:h,current:!0,month:i,year:s,today:h===k.getDate()&&i===k.getMonth()&&s===k.getFullYear()});if(!V){{let h=42-e(_).length;for(let T=1;T<=h;T++)e(_).push({day:T,current:!1,month:i+1})}return e(_)}}function $(s){e(C)+s>m&&e(p)===f||(o(C,e(C)+s),e(C)<0?(o(C,11),o2(p,-1)):e(C)>11&&(o(C,0),o2(p)),x(e(p),e(C)))}async function R(s){const i=s.day;o(D,H(new Date(e(p),s.month,i)));const r=e(D).toLocaleDateString("en-US",{day:"2-digit"}),v=e(D).toLocaleDateString("en-US",{month:"2-digit"}),g=await fetch(`/api/ticket?date=${e(p)}-${v}-${r}`);y(await g.json())}b2(()=>{x(e(p),e(C))});var I=q2(),Y=a(I),j=a(Y),z=a(j);z.__click=[M2,$];var F=l(z,2),U=a(F),E=a(U,!0);t(U);var J=l(U,2),e2=a(J,!0);t(J),t(F);var t2=l(F,2);t2.__click=[x2,$],t(j);var d=l(j,2);Q(d,21,()=>c,W,(s,i)=>{var r=V2(),v=a(r),g=a(v,!0);t(v),t(r),A(()=>w(g,e(i))),Z(s,r)}),t(d),t(Y);var n=l(Y,2);Q(n,21,()=>e(_),W,(s,i)=>{var r=L2();r.__click=[Z2,R,i];var v=a(r),g=a(v,!0);t(v),t(r),A(V=>{r2(r,1,`day square ${(e(i).today?"today":"")??""} ${(e(i).current?"":"notcurrent")??""} ${V??""}`,"svelte-10fq9ck"),w(g,e(i).day)},[()=>e(D).getDate()===e(i).day&&e(D).getMonth()===e(i).month&&e(D).getFullYear()===e(p)?"selected":""]),Z(s,r)}),t(n),t(I),A(()=>{w(E,e(O)),w(e2,e(p))}),Z(q,I),f2()}p2(["click"]);var S2=L('<li class="item svelte-1sknmpi"><div class="field currency svelte-1sknmpi"><p class="lineitem"></p></div> <div class="field svelte-1sknmpi"><p class="lineitem"> </p></div> <div class="field currency svelte-1sknmpi"><p class="lineitem"></p></div> <div class="field currency svelte-1sknmpi"><p class="lineitem"></p></div></li>');function $2(q,u){const{product:y,quantity:c,price:D}=u.ticketItem;let k=c*D;var m=S2(),f=a(m),C=a(f);C.textContent=c,t(f);var p=l(f,2),O=a(p),_=a(O,!0);t(O),t(p);var x=l(p,2),$=a(x);$.textContent=D,t(x);var R=l(x,2),I=a(R);I.textContent=k,t(R),t(m),A(()=>w(_,y.name)),Z(q,m)}const I2="data:image/svg+xml,%3csvg%20width='52'%20height='34'%20viewBox='0%200%2052%2034'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3.50967%200H48.0908C50.0219%200%2051.6005%201.57706%2051.6005%203.50967V30.4903C51.6005%2032.4214%2050.0219%2034%2048.0908%2034H3.50967C1.57864%2034%200%2032.4214%200%2030.4903V3.50967C0%201.57864%201.57864%200%203.50967%200ZM41.0225%2024.7415C41.6988%2024.7415%2042.3167%2024.9896%2042.7892%2025.4004C43.2633%2024.9912%2043.8811%2024.7415%2044.5559%2024.7415C46.0476%2024.7415%2047.258%2025.9519%2047.258%2027.4437C47.258%2028.9354%2046.0476%2030.1458%2044.5559%2030.1458C43.8811%2030.1458%2043.2633%2029.8978%2042.7892%2029.4885C42.3167%2029.8978%2041.6988%2030.1458%2041.0225%2030.1458C39.5308%2030.1458%2038.3203%2028.9354%2038.3203%2027.4437C38.3203%2025.9519%2039.5308%2024.7415%2041.0225%2024.7415ZM6.13757%2029.4585C4.73434%2029.4585%204.73434%2027.3252%206.13757%2027.3252H31.7055C33.1088%2027.3252%2033.1088%2029.4585%2031.7055%2029.4585H6.13757ZM10.3252%2016.5054L8.64538%2020.1841H12.1456L13.8253%2016.5054H10.3252ZM6.30982%2020.1841L7.98959%2016.5054H5.9353C5.73146%2016.5054%205.56079%2016.6761%205.56079%2016.8799V19.808C5.56079%2020.0119%205.73146%2020.1826%205.9353%2020.1826H6.30982V20.1841ZM33.6682%2016.5054L31.9884%2020.1841H34.0443C34.2481%2020.1841%2034.4188%2020.0119%2034.4188%2019.8096V16.8815C34.4188%2016.6776%2034.2481%2016.507%2034.0443%2016.507H33.6682V16.5054ZM29.6528%2020.1841L31.3326%2016.5054H27.8324L26.1526%2020.1841H29.6528ZM23.8171%2020.1841L25.4968%2016.5054H21.9967L20.3169%2020.1841H23.8171ZM17.9813%2020.1841L19.6611%2016.5054H16.1609L14.4811%2020.1841H17.9813ZM5.9353%2014.3721H34.0443C35.4254%2014.3721%2036.5536%2015.4988%2036.5536%2016.8815V19.8096C36.5536%2021.1923%2035.4269%2022.319%2034.0443%2022.319H5.9353C4.55261%2022.319%203.42592%2021.1923%203.42592%2019.8096V16.8815C3.42592%2015.4988%204.55261%2014.3721%205.9353%2014.3721ZM2.1333%204.97769H49.4656V3.51125C49.4656%202.75748%2048.8446%202.13646%2048.0908%202.13646H3.50967C2.7559%202.13646%202.13488%202.75906%202.13488%203.51125V4.97769H2.1333ZM49.4656%2012.4806H2.1333V30.4919C2.1333%2031.2457%202.75432%2031.8667%203.50809%2031.8667H48.0892C48.843%2031.8667%2049.464%2031.2457%2049.464%2030.4919V12.4806H49.4656Z'%20fill='%23fbc02a'/%3e%3c/svg%3e",Y2="data:image/svg+xml,%3csvg%20width='61'%20height='35'%20viewBox='0%200%2061%2035'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M56.2159%200H4.78412C2.14689%200%200%201.86533%200%204.1567V30.136C0%2032.4274%202.14689%2034.2927%204.78412%2034.2927H56.2159C58.8531%2034.2927%2061%2032.4274%2061%2030.136V4.1567C61%201.86533%2058.8531%200%2056.2159%200ZM58.6079%2030.1382C58.6079%2031.285%2057.5357%2032.2166%2056.2159%2032.2166H4.78412C3.4643%2032.2166%202.39209%2031.285%202.39209%2030.1382V4.15675C2.39209%203.01002%203.4643%202.07843%204.78412%202.07843H56.2159C57.5357%202.07843%2058.6079%203.01002%2058.6079%204.15675V30.1382Z'%20fill='%23191D22'/%3e%3cpath%20d='M55.0205%204.15625H5.98117C5.31999%204.15625%204.78516%204.62097%204.78516%205.19541V29.0966C4.78516%2029.6711%205.32003%2030.1358%205.98117%2030.1358H55.0205C55.6817%2030.1358%2056.2165%2029.671%2056.2165%2029.0966V5.19541C56.2165%204.62309%2055.6817%204.15625%2055.0205%204.15625ZM22.3984%2028.0591H13.0582C12.5531%2025.4515%2010.1808%2023.3903%207.17966%2022.9515L7.17718%2011.3421C10.1784%2010.9032%2012.5507%208.84203%2013.0558%206.23446H22.3959C18.2804%208.5516%2015.549%2012.5773%2015.549%2017.1466C15.549%2021.7158%2018.2802%2025.742%2022.3984%2028.0591ZM29.4013%2015.7117C29.696%2015.9677%2030.0847%2016.1075%2030.5008%2016.1075C32.6898%2016.1075%2034.4479%2017.648%2034.4479%2019.537C34.4479%2021.0667%2033.2915%2022.3641%2031.6969%2022.8052V24.3177C31.6969%2024.8921%2031.162%2025.3568%2030.5008%2025.3568C29.8397%2025.3568%2029.3048%2024.8921%2029.3048%2024.3177V22.9665H27.7498C27.0886%2022.9665%2026.5537%2022.5018%2026.5537%2021.9274C26.5537%2021.3529%2027.0886%2020.8882%2027.7498%2020.8882H30.5008C31.3576%2020.8882%2032.0559%2020.2815%2032.0559%2019.5371C32.0559%2018.7992%2031.37%2018.186%2030.5008%2018.186C28.3217%2018.186%2026.5537%2016.6519%2026.5537%2014.7565C26.5537%2013.2289%2027.7051%2011.9273%2029.3048%2011.4862V9.97584C29.3048%209.40138%2029.8396%208.93668%2030.5008%208.93668C31.1619%208.93668%2031.6968%209.4014%2031.6968%209.97584V11.327H33.2519C33.913%2011.327%2034.4479%2011.7917%2034.4479%2012.3661C34.4479%2012.9406%2033.913%2013.4053%2033.2519%2013.4053H30.5008C30.0848%2013.4053%2029.696%2013.5451%2029.4013%2013.8012C28.7946%2014.3283%2028.7922%2015.1824%2029.4013%2015.7117ZM53.8243%2022.9517C50.8231%2023.3906%2048.4508%2025.4517%2047.9457%2028.0593H38.6056C42.7211%2025.7422%2045.4525%2021.7165%2045.4525%2017.1472C45.4525%2012.5779%2042.7212%208.55226%2038.6056%206.23512H47.9457C48.4509%208.84275%2050.8231%2010.9039%2053.8243%2011.3427V22.9517Z'%20fill='%23fbc02a'/%3e%3c/svg%3e";var j2=(q,u,y)=>u(e(y).id),F2=L('<div class="icon card"><img alt="tarjeta"></div>'),P2=L('<div class="icon cash"><img alt="efectivo"></div>'),B2=L('<li><button><p class="date"> </p> <p class="number"> </p> <div class="payment"><!> <!></div> <div></div></button></li>'),O2=L('<div class="panel--header svelte-kk4496"><div class="biginfo svelte-kk4496"><p class="title"> </p> <p class="title"> </p></div> <div class="labels svelte-kk4496"><p class="svelte-kk4496">cantidad</p> <p class="svelte-kk4496">producto</p> <p class="svelte-kk4496">precio</p> <p class="svelte-kk4496">importe</p></div></div> <ul class="panel--body svelte-kk4496"></ul> <footer class="svelte-kk4496"><p> </p> <p> </p> <div class="summary svelte-kk4496"><p class="summary--label svelte-kk4496">Total</p> <p class="summary--amount svelte-kk4496"> </p></div> <div class="buttonRow svelte-kk4496"><!> <!></div></footer>',1),R2=L('<div class="panel svelte-kk4496"><!></div>'),U2=L('<main class="ticketpage svelte-kk4496"><div class="calendar svelte-kk4496"><!></div> <div class="table-wrapper svelte-kk4496"><div class="table"><div class="table--header"><p>fecha</p> <p>total</p></div> <ul class="table--body"></ul></div></div> <div class="panel-wrapper svelte-kk4496"><!></div></main>');function K2(q,u){u2(u,!0);let y=S(H(u.data.tickets)),c=S(H({})),D=K(()=>e(c).ticket_details),k=K(()=>new Date(e(c).date)),m=S(!1),f=S(!1),C=K(()=>e(k).toLocaleString(void 0,{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,year:"numeric",month:"long",day:"2-digit"}));async function p(d){try{const s=await(await fetch(`/api/ticket/${d}`)).json();o(c,H(s))}catch(n){console.error("Problem with fetch:",n)}}async function O(){if(e(f)){o(f,!1),o(m,!1);return}if(e(m))try{if(await(await fetch(`/api/ticket/${e(c).id}`,{method:"PATCH",headers:{"Content-Type":"application/json"}})).json()){const s=e(k).getFullYear(),i=e(k).toLocaleDateString("en-US",{day:"2-digit"}),r=e(k).toLocaleDateString("en-US",{month:"2-digit"}),v=await fetch(`/api/ticket?date=${s}-${r}-${i}`);o(y,H(await v.json())),o(m,!1)}}catch(d){console.error("Could not cancel ticket: ",d)}else o(m,!0)}let _=S(null),x=null,$;async function R(d){x&&clearTimeout(x),e(f)?(o(_,H(I())),e(_).finally(()=>{x=setTimeout(()=>{o(_,null)},$)})):(o(_,null),I())}async function I(d){if(e(m)){o(f,!1),o(m,!1);return}if(e(f)){const n={ticket:e(c),details:e(D),printerIP:D2.ip},s=await window.api.printTicket(JSON.parse(JSON.stringify(n)));return o(f,!1),s.success?$=300:$=5e3,s}else return o(f,!0),Promise.resolve()}var Y=U2(),j=a(Y),z=a(j);T2(z,{get tickets(){return e(y)},set tickets(d){o(y,H(d))}}),t(j);var F=l(j,2),U=a(F),E=l(a(U),2);Q(E,21,()=>e(y),W,(d,n)=>{var s=B2(),i=a(s);i.__click=[j2,p,n];var r=a(i),v=a(r,!0);t(r);var g=l(r,2),V=a(g,!0);t(g);var P=l(g,2),B=a(P);{var h=b=>{var M=F2(),X=a(M);v2(X,"src",I2),t(M),Z(b,M)};i2(B,b=>{e(n).card>0&&b(h)})}var T=l(B,2);{var G=b=>{var M=P2(),X=a(M);v2(X,"src",Y2),t(M),Z(b,M)};i2(T,b=>{e(n).cash>0&&b(G)})}t(P);var N=l(P,2);t(i),t(s),A(b=>{r2(s,1,`table--item ${(e(c).id===e(n).id?"selected":"")??""}`),w(v,b),w(V,e(n).total_amount),r2(N,1,`cancel ${(e(n).canceled?"cancelado":"")??""}`)},[()=>new Date(e(n).date).toLocaleTimeString(void 0,{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone})]),Z(d,s)}),t(E),t(U),t(F);var J=l(F,2),e2=a(J);{var t2=d=>{var n=R2(),s=a(n);y2(s,()=>e(c).id,i=>{var r=O2(),v=C2(r),g=a(v),V=a(g),P=a(V,!0);t(V);var B=l(V,2),h=a(B,!0);t(B),t(g),g2(2),t(v);var T=l(v,2);Q(T,21,()=>e(c).ticket_details,W,(s2,m2)=>{$2(s2,{get ticketItem(){return e(m2)}})}),t(T);var G=l(T,2),N=a(G),b=a(N,!0);t(N);var M=l(N,2),X=a(M,!0);t(M);var a2=l(M,2),l2=l(a(a2),2),_2=a(l2,!0);t(l2),t(a2);var n2=l(a2,2),c2=a(n2);d2(c2,{action:O,text:"cancelar",flexBasis:"50%",get ready(){return e(m)},get disabled(){return e(c).canceled}});var k2=l(c2,2);d2(k2,{action:R,text:"imprimir",flexBasis:"50%",get ready(){return e(f)},get promise(){return e(_)}}),t(n2),t(G),A(s2=>{w(P,s2),w(h,e(C)),w(b,e(c).cash),w(X,e(c).card),w(_2,e(c).total_amount)},[()=>e(c).id.slice(0,8)]),Z(i,r)}),t(n),w2(1,n,()=>H2,()=>({y:30,duration:500})),Z(d,n)};i2(e2,d=>{e(c).id&&d(t2)})}t(J),t(Y),Z(q,Y),f2()}p2(["click"]);export{K2 as component};
